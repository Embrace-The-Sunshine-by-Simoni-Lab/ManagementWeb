{"ast":null,"code":"import _asyncToGenerator from \"/Users/zhaoyuliu/Desktop/matx-pro-3.3.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/zhaoyuliu/Desktop/matx-pro-3.3.0/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"/Users/zhaoyuliu/Desktop/matx-pro-3.3.0/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\n\nvar _jsxFileName = \"/Users/zhaoyuliu/Desktop/matx-pro-3.3.0/src/app/contexts/FirebaseAuthContext.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport _regeneratorRuntime from \"/Users/zhaoyuliu/Desktop/matx-pro-3.3.0/node_modules/@babel/runtime/regenerator/index.js\";\nimport React, { createContext, useEffect, useReducer } from 'react';\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/auth';\nimport { firebaseConfig } from 'config.js';\nimport { MatxLoading } from 'app/components';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nif (!firebase.apps.length) {\n  firebase.initializeApp(firebaseConfig);\n}\n\nvar initialAuthState = {\n  isAuthenticated: false,\n  isInitialised: false,\n  user: null\n};\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'FB_AUTH_STATE_CHANGED':\n      {\n        var _action$payload = action.payload,\n            isAuthenticated = _action$payload.isAuthenticated,\n            user = _action$payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: isAuthenticated,\n          isInitialised: true,\n          user: user\n        });\n      }\n\n    default:\n      {\n        return _objectSpread({}, state);\n      }\n  }\n};\n\nvar AuthContext = /*#__PURE__*/createContext(_objectSpread(_objectSpread({}, initialAuthState), {}, {\n  method: 'FIREBASE',\n  createUserWithEmailAndPassword: function createUserWithEmailAndPassword() {\n    return Promise.resolve();\n  },\n  signInWithEmailAndPassword: function signInWithEmailAndPassword() {\n    return Promise.resolve();\n  },\n  signInWithGoogle: function signInWithGoogle() {\n    return Promise.resolve();\n  },\n  logout: function logout() {\n    return Promise.resolve();\n  }\n}));\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useReducer = useReducer(reducer, initialAuthState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var signInWithEmailAndPassword = function signInWithEmailAndPassword(email, password) {\n    return firebase.auth().signInWithEmailAndPassword(email, password);\n  };\n\n  var signInWithGoogle = function signInWithGoogle() {\n    console.log('google');\n    var provider = new firebase.auth.GoogleAuthProvider();\n    return firebase.auth().signInWithPopup(provider);\n  };\n\n  var createUserWithEmailAndPassword = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(email, password) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              return _context.abrupt(\"return\", firebase.auth().createUserWithEmailAndPassword(email, password));\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function createUserWithEmailAndPassword(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var logout = function logout() {\n    return firebase.auth().signOut();\n  };\n\n  useEffect(function () {\n    var unsubscribe = firebase.auth().onAuthStateChanged(function (user) {\n      if (user) {\n        dispatch({\n          type: 'FB_AUTH_STATE_CHANGED',\n          payload: {\n            isAuthenticated: true,\n            user: {\n              id: user.uid,\n              name: user.displayName || user.email,\n              avatar: user.photoURL,\n              email: user.email\n            }\n          }\n        });\n      } else {\n        dispatch({\n          type: 'FB_AUTH_STATE_CHANGED',\n          payload: {\n            isAuthenticated: false,\n            user: null\n          }\n        });\n      }\n    });\n    return unsubscribe;\n  }, [dispatch]);\n\n  if (!state.isInitialised) {\n    return /*#__PURE__*/_jsxDEV(MatxLoading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 16\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: _objectSpread(_objectSpread({}, state), {}, {\n      method: 'FIREBASE',\n      createUserWithEmailAndPassword: createUserWithEmailAndPassword,\n      signInWithEmailAndPassword: signInWithEmailAndPassword,\n      signInWithGoogle: signInWithGoogle,\n      logout: logout\n    }),\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 9\n  }, _this);\n};\n\n_s(AuthProvider, \"//4mWrSOuqoEUUutHOK3gWkly1o=\");\n\n_c = AuthProvider;\nexport default AuthContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/zhaoyuliu/Desktop/matx-pro-3.3.0/src/app/contexts/FirebaseAuthContext.js"],"names":["React","createContext","useEffect","useReducer","firebase","firebaseConfig","MatxLoading","apps","length","initializeApp","initialAuthState","isAuthenticated","isInitialised","user","reducer","state","action","type","payload","AuthContext","method","createUserWithEmailAndPassword","Promise","resolve","signInWithEmailAndPassword","signInWithGoogle","logout","AuthProvider","children","dispatch","email","password","auth","console","log","provider","GoogleAuthProvider","signInWithPopup","signOut","unsubscribe","onAuthStateChanged","id","uid","name","displayName","avatar","photoURL"],"mappings":"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","sourcesContent":["import React, { createContext, useEffect, useReducer } from 'react'\r\nimport firebase from 'firebase/compat/app'\r\nimport 'firebase/compat/auth'\r\nimport { firebaseConfig } from 'config.js'\r\nimport { MatxLoading } from 'app/components'\r\n\r\nif (!firebase.apps.length) {\r\n    firebase.initializeApp(firebaseConfig)\r\n}\r\n\r\nconst initialAuthState = {\r\n    isAuthenticated: false,\r\n    isInitialised: false,\r\n    user: null,\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n    switch (action.type) {\r\n        case 'FB_AUTH_STATE_CHANGED': {\r\n            const { isAuthenticated, user } = action.payload\r\n\r\n            return {\r\n                ...state,\r\n                isAuthenticated,\r\n                isInitialised: true,\r\n                user,\r\n            }\r\n        }\r\n        default: {\r\n            return { ...state }\r\n        }\r\n    }\r\n}\r\n\r\nconst AuthContext = createContext({\r\n    ...initialAuthState,\r\n    method: 'FIREBASE',\r\n    createUserWithEmailAndPassword: () => Promise.resolve(),\r\n    signInWithEmailAndPassword: () => Promise.resolve(),\r\n    signInWithGoogle: () => Promise.resolve(),\r\n    logout: () => Promise.resolve(),\r\n})\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [state, dispatch] = useReducer(reducer, initialAuthState)\r\n\r\n    const signInWithEmailAndPassword = (email, password) => {\r\n        return firebase.auth().signInWithEmailAndPassword(email, password)\r\n    }\r\n\r\n    const signInWithGoogle = () => {\r\n        console.log('google')\r\n        const provider = new firebase.auth.GoogleAuthProvider()\r\n        return firebase.auth().signInWithPopup(provider)\r\n    }\r\n\r\n    const createUserWithEmailAndPassword = async (email, password) => {\r\n        return firebase.auth().createUserWithEmailAndPassword(email, password)\r\n    }\r\n\r\n    const logout = () => {\r\n        return firebase.auth().signOut()\r\n    }\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = firebase.auth().onAuthStateChanged((user) => {\r\n            if (user) {\r\n                dispatch({\r\n                    type: 'FB_AUTH_STATE_CHANGED',\r\n                    payload: {\r\n                        isAuthenticated: true,\r\n                        user: {\r\n                            id: user.uid,\r\n                            name: user.displayName || user.email,\r\n                            avatar: user.photoURL,\r\n                            email: user.email,\r\n                        },\r\n                    },\r\n                })\r\n            } else {\r\n                dispatch({\r\n                    type: 'FB_AUTH_STATE_CHANGED',\r\n                    payload: {\r\n                        isAuthenticated: false,\r\n                        user: null,\r\n                    },\r\n                })\r\n            }\r\n        })\r\n\r\n        return unsubscribe\r\n    }, [dispatch])\r\n\r\n    if (!state.isInitialised) {\r\n        return <MatxLoading />\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                ...state,\r\n                method: 'FIREBASE',\r\n                createUserWithEmailAndPassword,\r\n                signInWithEmailAndPassword,\r\n                signInWithGoogle,\r\n                logout,\r\n            }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\nexport default AuthContext\r\n"]},"metadata":{},"sourceType":"module"}